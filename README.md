# ST3215-3-DualButton

M5StampS3 を使用して STS3215 サーボモーター 3 台を 6 つのボタンで制御するプロジェクト。

## 概要

各サーボモーターに対して正回転・逆回転用の 2 つのボタンを割り当て、計 6 つのボタンで 3 台の STS3215 を制御します。

## ハードウェア構成

### マイコン

- **M5StampS3** (ESP32-S3)

### サーボモーター

- **Feetech STS3215** x 3 台
  - ID 1, 2, 3
  - TTL シリアル通信（半二重）
  - 動作電圧: 6〜12V

### ピン配置

| 機能                        | M5StampS3 ピン |
| --------------------------- | -------------- |
| Serial TX                   | GPIO43         |
| Serial RX                   | GPIO44         |
| ボタン 1（サーボ 1 正回転） | GPIO1          |
| ボタン 2（サーボ 1 逆回転） | GPIO2          |
| ボタン 3（サーボ 2 正回転） | GPIO3          |
| ボタン 4（サーボ 2 逆回転） | GPIO4          |
| ボタン 5（サーボ 3 正回転） | GPIO5          |
| ボタン 6（サーボ 3 逆回転） | GPIO6          |

### 配線

STS3215 はデイジーチェーン接続可能。最初のサーボのみ M5StampS3 に接続し、残りは順番に接続。

```
M5StampS3 TX (GPIO43) ──┐
                        ├── STS3215 (ID:1) ── STS3215 (ID:2) ── STS3215 (ID:3)
M5StampS3 RX (GPIO44) ──┘
```

※ TTL 通信のため、TX/RX を 1 本の信号線に接続する回路（半二重変換）が必要。

## 動作仕様

- ボタンを押している間、対応するサーボが回転
- ボタンを離すと停止
- 各サーボは独立して制御可能

| ボタン   | 動作                   |
| -------- | ---------------------- |
| ボタン 1 | サーボ 1 正回転（CW）  |
| ボタン 2 | サーボ 1 逆回転（CCW） |
| ボタン 3 | サーボ 2 正回転（CW）  |
| ボタン 4 | サーボ 2 逆回転（CCW） |
| ボタン 5 | サーボ 3 正回転（CW）  |
| ボタン 6 | サーボ 3 逆回転（CCW） |

## 使用ライブラリ

- [FTServo](https://github.com/ftservo/FTServo_Arduino) - Feetech 公式バスサーボライブラリ
  - `platformio.ini` の `lib_deps` で自動インストール

## ビルド・書き込み

```bash
# ビルド
pio run

# 書き込み
pio run --target upload

# シリアルモニタ
pio device monitor
```
